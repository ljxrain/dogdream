# 造梦者网站 - 完全自动化管理系统

## 🎯 系统概述

这是一个完全自动化的开发环境管理系统，能够自动启动PostgreSQL数据库服务器、检测和修复环境配置、同步备份文件，并启动Node.js开发服务器。真正实现一键启动整个开发环境。

## 📁 文件结构

```
D:\dream\
├── .env                          # 当前环境配置文件 (Git忽略)
├── env-backup.txt               # 真实配置备份 (包含密码，不被Git忽略)
├── env-backup-template.txt      # 安全模板文件 (密码已隐藏，可安全分享)
├── check-env.ps1               # 环境检查和修复脚本
├── sync-backup.ps1             # 备份同步脚本
├── init-database.ps1           # 数据库初始化脚本
├── start.ps1                   # 基础启动脚本
├── start-smart.ps1             # 智能启动脚本
├── start-full-auto.ps1         # 全自动启动脚本 (推荐)
├── 启动造梦者.bat               # 基础一键启动
├── 全自动启动造梦者.bat         # 全自动一键启动 (推荐)
├── 服务管理.bat                 # 服务管理中心 (推荐)
└── 更新备份.bat                 # 手动更新备份文件
```

## 🚀 使用方法

### 方法1：服务管理中心 (最推荐)
```bash
双击 "服务管理.bat"
```
提供完整的图形化菜单，包括：
- 🚀 全自动启动
- 🗄️ 仅启动数据库服务
- 🌐 仅启动开发服务器
- 📊 检查服务状态
- ⏹️ 停止所有服务
- 🔄 重启所有服务

### 方法2：全自动启动 (推荐)
```bash
双击 "全自动启动造梦者.bat"
```

### 方法3：PowerShell全自动启动
```bash
powershell -ExecutionPolicy Bypass -File start-full-auto.ps1
```

### 方法4：传统启动方式
```bash
双击 "启动造梦者.bat"  # 仅启动开发服务器
```

## 🔄 全自动启动流程

全自动启动脚本会按顺序执行以下步骤：

1. **清理旧进程** - 停止之前运行的Node.js进程
2. **启动数据库服务** - 自动启动PostgreSQL服务
3. **初始化数据库** - 确保dreamhome数据库存在
4. **环境配置检查** - 验证和修复.env文件
5. **同步备份文件** - 自动检测并同步配置变化
6. **设置环境变量** - 配置运行时环境
7. **检查端口占用** - 验证端口5173可用性
8. **启动开发服务器** - 启动Vite开发服务器

## 🗄️ 数据库自动管理

### 自动服务启动
- 自动检测PostgreSQL服务状态
- 支持多种服务名称：`postgresql-x64-17`, `postgresql-17`, `PostgreSQL`, `postgresql`
- 如果服务未运行，自动启动

### 自动数据库初始化
- 检查`dreamhome`数据库是否存在
- 如果不存在，自动创建
- 验证数据库连接

### 数据库配置
```
数据库名称: dreamhome (无下划线)
用户名: postgres
密码: postgres (第3个选项)
端口: 5432
```

## 🔄 配置同步机制

### 自动同步
- 全自动启动脚本会自动检测 `.env` 文件是否比备份文件新
- 如果检测到变化，会自动运行同步脚本更新备份文件

### 手动同步
当您修改了 `.env` 文件后，可以通过以下方式同步备份：

1. **使用服务管理中心**
   ```bash
   双击 "服务管理.bat" → 选择相应选项
   ```

2. **使用BAT文件** (推荐)
   ```bash
   双击 "更新备份.bat"
   ```

3. **使用PowerShell**
   ```bash
   powershell -ExecutionPolicy Bypass -File sync-backup.ps1
   ```

## 📋 配置文件说明

### .env (当前配置)
- 实际使用的环境配置文件
- 被Git忽略，不会提交到代码库
- 如果丢失会自动从 `env-backup.txt` 恢复

### env-backup.txt (真实备份)
- 包含真实密码的完整配置备份
- **不被Git忽略**，确保备份不会丢失
- 用于自动恢复系统

### env-backup-template.txt (安全模板)
- 密码已隐藏的安全版本
- 可以安全地分享给团队成员
- 用于新环境的配置参考

## ⚙️ 当前配置 (第3个密码选项)

```
数据库名称: dreamhome (无下划线)
用户名: postgres
密码: postgres
开发服务器端口: 5173
数据库端口: 5432
```

## 🔧 服务管理

### 启动服务
- **全自动启动**: 一键启动数据库+开发服务器
- **仅启动数据库**: 只启动PostgreSQL服务
- **仅启动开发服务器**: 只启动Node.js开发服务器

### 停止服务
- **停止所有服务**: 停止数据库和开发服务器
- **重启所有服务**: 重启整个系统

### 状态检查
- PostgreSQL服务状态
- Node.js进程状态
- 端口占用情况

## 🔧 维护指南

### 当需要修改配置时：

1. **修改 `.env` 文件**
   ```bash
   # 直接编辑 .env 文件
   notepad .env
   ```

2. **同步到备份文件**
   ```bash
   # 方法1: 使用服务管理中心
   双击 "服务管理.bat"
   
   # 方法2: 使用BAT文件
   双击 "更新备份.bat"
   
   # 方法3: 下次启动时自动同步
   双击 "全自动启动造梦者.bat"
   ```

### 故障排除

1. **如果PostgreSQL服务无法启动**
   - 检查PostgreSQL是否正确安装
   - 确认服务名称是否正确
   - 使用服务管理中心检查状态

2. **如果数据库连接失败**
   - 确认PostgreSQL服务正在运行
   - 检查用户名密码是否正确 (postgres/postgres)
   - 确认数据库`dreamhome`是否存在

3. **如果开发服务器无法启动**
   - 检查端口5173是否被占用
   - 确认Node.js和npm是否正确安装
   - 检查项目依赖是否完整

4. **如果配置文件丢失**
   - 系统会自动从 `env-backup.txt` 恢复
   - 或手动运行: `powershell -ExecutionPolicy Bypass -File check-env.ps1`

## 🎉 优势特点

- ✅ **完全自动化**: 一键启动数据库+开发服务器
- ✅ **智能服务管理**: 自动检测和启动PostgreSQL服务
- ✅ **数据库自动初始化**: 自动创建和配置数据库
- ✅ **智能恢复**: 配置丢失时自动恢复
- ✅ **版本同步**: 自动检测并同步配置变化
- ✅ **安全分享**: 提供隐藏密码的模板文件
- ✅ **图形化管理**: 服务管理中心提供友好界面
- ✅ **故障自愈**: 自动检测和修复各种问题

## 📞 技术支持

如果遇到问题，请按以下顺序检查：

1. **使用服务管理中心检查状态**
   ```bash
   双击 "服务管理.bat" → 选择 "4. 📊 检查服务状态"
   ```

2. **尝试重启所有服务**
   ```bash
   双击 "服务管理.bat" → 选择 "6. 🔄 重启所有服务"
   ```

3. **检查系统要求**
   - PostgreSQL 17 已安装并配置
   - Node.js 和 npm 已安装
   - 端口5173和5432未被其他程序占用
   - PowerShell执行策略允许脚本运行

4. **查看详细错误信息**
   - 使用PowerShell直接运行脚本查看详细输出
   - 检查Windows事件日志中的PostgreSQL相关错误 